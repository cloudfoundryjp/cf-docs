---
title: クラウド向けのアプリケーションのデザイン
---

Cloud Foundry にサポートされているランタイムやフレームワークを用いて書かれたアプリケーションは、たいていはそのまま動作します。ただし、以下のガイドラインに従っている必要があります。ガイドラインに従うことにより、アプリケーションはクラウドへの親和性を持ち、Cloud
Foundryや他のクラウド・プラットフォームへのデプロイが容易になります。

## <a id="filesystem"></a>ローカル・ファイル・システムへの書き込みを避ける ##

Cloud Foundry上で動作するアプリケーションはローカル・ファイル・システムへの書き込みを避ける必要があります。これにはいくつかの理由があります。

* ローカル・ファイル・システムは永続しない
  アプリケーションがクラッシュや停止した時、割り当てられていた資源は解放されてしまいます。theインスタンスが再起動した時、新しいディスク・イメージが割り当てられます。アプリケーションはローカル・ファイル・システムへ書き込むことはできますが、再起動するとファイルは消えてしまいます。

* 同じアプリケーションのインスタンスが複数ある場合、ローカル・ファイル・システムは共有されません。それぞれのインスタンスは独立したコンテナ内で実行されます。従って、あるインスタンスが書いたファイルは別のインスタンスからは見えません。一時ファイルであるなら、問題ありません。再起動後も必要なデータや、複数のインスタンスで共有するデータはファイルへ書くべきではありません。そのような使い方には、データベースやブロブ・ストアのようなデータ共有サービスを使うことをお奨めします。

ローカル・ファイル・システムを使わなくても、MongoDBドキュメント・データベースやRDB(MySQLかPostgres)を使うことができます。別の選択肢として、[Amazon S3](http://aws.amazon.com/s3/), [Google Cloud Storage](https://cloud.google.com/products/cloud-storage), [Dropbox](https://www.dropbox.com/developers), [Box](http://developers.box.com/)などのクラウド・ストレージが挙げられます。あなたのアプリケーションが別のインスタンスとの通信を必要とするなら(例えば状態の共有など)、RedisのようなキャッシュやRabbitMQなどのメッセージに基づくサービスを考慮した方がよいでしょう。

## <a id="sessions"></a>HTTPセッションは永続化または複製されない ##

jsessionidクッキーが使われていれば、Cloud
Foundryはセッション・アフィニティやスティッキー・セッションをサポートします。あるアプリケーションの複数のインスタンスが動作していれば、あるクライアントからのリクエストはすべて一つのインスタンスへ向けられます。これにより、アプリケーションやフレームワークは各ユーザのセッション情報を取り扱うことができます。

Cloud FoundryはHTTPセッションは永続化または複製しません。インスタンスがクラッシュまたは停止すると、HTTPセッションのデータは失なわれます。クラッシュまたは停止したインスタンスに対してスティッキーだったユーザ・セッションからリクエストが送られると、そのリクエストは他のインスタンスへ向けられます。

アプリケーションのクラッシュや停止の後も必要なデータやインスタンス間で共有する必要があるデータは、Cloud Foundryのサービスを使って保持すべきです。データ・サービスのセッションを共有するオープン・ソース・プロジェクトがいくつもあります。

## <a id="ports"></a> HTTPとHTTPSポートの制限 ##

Cloud Foundry上で動作しているアプリケーションは、設定されたURLへのポート80(HTTPの標準)と443(HTTPSの標準)に対するリクエストのみを受信します。

Cloud Foundry v1とは異り、Cloud Foundry v2のサービス(MySQL, Postgres, MongoDB, Redis, RabbitMQ)は外部から直接接続できます。これらのサービスはCloud Foundryパートナーによって提供されているためです。env.logから、またはCloud Foundry APIを通じて、接続のメタ・データと資格情報を得ることができます。
