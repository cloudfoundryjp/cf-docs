<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>アプリケーションのデプロイとヘルスのトラブルシューティング</title>

    <link href="../../../stylesheets/master.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="../../../javascripts/all.js" type="text/javascript"></script>
    <link href='/images/favicon.ico' rel='shortcut icon'>
    <script type="text/javascript">
      $(document).ready(function(){
        $('a#search').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 20px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2').css("padding","11px 10px 8px");
          $('#search-on').show();
          $('#search-off').hide();
        });
        $('.cancel-x').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 63px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2, #organization_bar .navbar .nav>li a#search').css("padding","16px 20px 15px");
          $('#organization_bar .navbar .nav>li a#getinvolved').css("padding","11px 92px 8px");
          $('#organization_bar .navbar .nav>li#docs-off .docs-list-list a').css("padding","0");
          $('#search-on').hide();
          $('#search-off').show();
        });f
        $(".togglebutton").click(function () {
        var divname= this.value;
          $("#"+divname).show("slow").siblings().hide("slow");
        });
      });
    </script>

    <!--[if lt IE 9]>
    <style>
        #content .container-full {background:  #ebf0fa;}
        .call-to-contribute-box, .column-left, .column-middle, .column-right {background:#e3e8f2}
        #footer {background:#000;}
    </style>
    <![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22181585-1']);
      _gaq.push(['_setDomainName', 'cloudfoundry.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body class="docs docs_using docs_using_managing-apps docs_using_managing-apps_troubleshoot-app-health">
    <img id="bg" src="/images/bg-plain-x.jpg">
    <div id='non_footer'>
      <div id='header'>
        <div class='container_wide'>
          <ul class='actions'>
            <li class='last'>
              <a href="http://www.cloudfoundry.com/contact">Contact Us</a>
            </li>
            <li>
              <a class='register_link' href='http://login.run.pivotal.io/login'>My Account</a>            
            </li>
          </ul>
        </div>
      </div>
      <div id='content'>
        <div class='logo-main'>
          <div class='logo'>
            <a href='http://www.cloudfoundry.com'>
            <img src='/images/logo-cloudfoundry.png'>
            </a>
            <a href='http://www.gopivotal.com' target="_blank">
            <img id="pivotal-logo" src='/images/logo-pivotal.png'>
            </a>
          </div>
          <div class='cta'>
            <a href='https://console.run.pivotal.io'>
            <img src='/images/signup_freetrial.png'>
            </a>
          </div>
        </div><!-- End of logo-main-->
        <div class='container-full'>
          <div id='organization_bar'>
            <div class='navbar'>
              <ul class='nav'>
                <li>
                <a href='http://www.cloudfoundry.com/use' id='use'>Using Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/run' id='run'>Running Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/getinvolved' id='getinvolved'>Get Involved</a>
                </li>
                <li id='docs-off'>
                  <a href='/' id='docs'>
                    <div id='icon-docs'></div>
                  </a>
                  <div id='docs-list'>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/using/app-arch/'>Using Cloud Foundry</a>
                      <br>
                      <a href="/docs/using/app-arch/">Application Architecture Considerations</a>
                      <br>
                      <a href='/docs/using/deploying-apps/'>Deploying Apps</a>
                      <br>
                      <a href='/docs/using/managing-apps/'>Managing Apps</a>
                      <br>
                      <a href='/docs/using/services.html'>Using Services</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/using/">See all</a>
                    </div><!-- End of 1st column docs-list-list-->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/running/'>Running Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/architecture/'>Architecture</a>
                      <br>
                      <a href='/docs/running/bosh/'>BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf/'>Deploying with BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf-with-chef/'>Deploying with Chef</a>
                      <br>
                      <a href='/docs/running/micro_cloud_foundry/'>Micro Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/managing-cf/index.html'>Managing Cloud Foundry</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/running/">See all</a>
                    </div><!-- End of column 2 docs-list-list -->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/reference/'>Reference</a>
                      <br>
                      <a href='/docs/reference/cc-api.html'>Cloud Foundry REST API</a>
                      <br>
                      <a class="docs-list-th" href='/docs/dotcom/'>CloudFoundry.com</a>
                      <br>
                      <a href='/docs/dotcom/integration/'>Technical Integration</a>
                      <br>
                      <a class="docs-list-th" href='/docs/community/'>Community</a>
                    </div><!-- End of column 3 docs-list-list -->
                  </div><!-- End of docs-list -->
                </li>
                <li id='search-off'>
                  <a id='search'>
                    <div class='icon-search'></div>
                  </a>
                </li>
                <li id='search-on'>
                  <a id='search2'>
                    <form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
                      <input autocomplete='off' class='search-input' id='search-query' name='q' onfocus="this.placeholder = ''" placeholder='' type='search' value=''>
                    </form>
                    <div class="cancel-x"></div>
                  </a>
                </li>
              </ul>
            </div><!-- End of navbar -->
          </div><!-- End of organization_bar -->
          <div class='content_inner'>
            <a class="forkme" href="http://github.com/cloudfoundry/cf-docs" target="_blank">
              <img alt="Fork me on GitHub" src="/images/ribbon_forkme.png">
            </a>
            <form action='http://www.cloudfoundry.com/search' class='search-docs-form' method='get' onsubmit='return submitQuery()'>
              <input autocomplete='off' class='search-docs-input' id='search-query' name='q' onfocus="this.placeholder = 'more:docs '" placeholder='' type='search-docs' value='more:docs '>
            </form>
            <br clear="left">
            
              <div class="breadcrumbs">
                <ul>
                  <li>
                    <a href="/">Home</a>
                  </li>
                  <li class=""><a href="../">Cloud Foundryを使用する</a></li> <li class=""><a href="./">アプリ、オーガナイゼーション、スペースの管理</a></li> <li class="active"><span>アプリケーションのデプロイとヘルスのトラブルシューティング</span></li>
                </ul>
              </div>
              <br clear="left">

			

              <div class="quick-links"><ul>
<li><a href="#cf-commands">cfトラブルシューティングのコマンド</a></li>
<li><a href="#java-apps">JavaとGrailsのお勧めの使い方</a>

<ul>
<li><a href="#jdbc">JDBCドライバの提供</a></li>
<li><a href="#memory">適切なメモリの割当</a></li>
<li><a href="#upload">アップロードの失敗のトラブルシュート</a></li>
<li><a href="#slow-start">Slow Starting Java or Grails Apps</a></li>
</ul></li>
<li><a href="#node-apps">Nodeのベスト・プラクティス</a></li>
<li><a href="#ruby-apps">Rubyのベスト・プラクティス</a></li>
</ul>
</div>

              <h1>アプリケーションのデプロイとヘルスのトラブルシューティング</h1>

            
            <h2><a id='cf-commands'></a>cfトラブルシューティングのコマンド</h2>

<p>Cloud Foundryのcfコマンド・ライン・インタフェースはデプロイしたアプリケーションの調査や状態を調べる様々なコマンドを備えています。</p>

<ul>
<li><p><code>cf apps</code> &mdash; 現在のスペースにデプロイされたアプリケーションの一覧を表示します。インスタンスの数やメモリとディスクの割当てなどのデプロイ時のオプション、各アプリケーションの現在の状態も含みます。使い方については<a href="cf/">cf Command Line Interface</a>ページの<a href="cf/#apps">apps</a>セクションをご覧ください。</p></li>
<li><p><code>cf app</code> &mdash; 一つのアプリケーションの各インスタンスの状態を返します。現在の状態、稼動時間、CPU、メモリ、ディスクの使用量を含みます。使い方については<a href="cf/#app">app</a>をご覧ください。</p></li>
<li><p><code>cf logs</code> &mdash; 環境変数、ステージングのログ、最近のSTDOUTとSTDERRを見ることができます。<code>VCAP_SERVICES</code>がバインドされたサービスや利用者情報の一覧を保持しています。</p>

<p>あなたのアプリケーションをSTDOUTやSTDERRへメッセージを出力するように設定する必要がある場合があります。もしlog4jを使ってログをSTDOUTへ送るようにしていれば、<code>logs</code>コマンドで見ることができます。(STDOUTやSTDERRでなくファイルへメッセージを送るようになっているのなら、<code>cf file</code>コマンドを使ってください)</p>

<p><strong>注意:</strong>  <code>cf logs</code>は利用者情報も返すため、公開する場合は大事な情報を削除してからにしましょう。</p>

<p>使い方については<a href="cf/#logs">logs</a>をご覧ください。</p></li>
<li><p><code>cf events</code> &mdash; このコマンドはアプリケーションがクラッシュした時の情報を返します。エラー・コードも含みます。Cloud Foundryのエラーについては <a href="https://github.com/cloudfoundry/errors">https://github.com/cloudfoundry/errors</a> をご覧ください。使い方については<a href="cf/#eventss">events</a>をご覧ください。</p></li>
<li><p><code>cf files</code>と<code>cf file</code>&mdash; アプリケーションのディレクトリのファイル一覧やファイルの内容を見ることができます。使い方については<a href="cf/#files">files</a>と<a href="cf/#file">file</a>をご覧ください。</p></li>
<li><p><code>cf guid</code> &mdash; アプリケーションのguidを返します。使い方については<a href="cf/#guid">guid</a>をご覧ください。</p></li>
<li><p><code>cf stats</code> &mdash; アプリケーションの各インスタンスのリソース使用状況を表示します。CPU、メモリ、ディスクの使用状況を含みます。使い方については<a href="cf/#stats">stats</a>をご覧ください。</p></li>
</ul>

<h2><a id='java-apps'></a>JavaとGrailsのお勧めの使い方</h2>

<h3><a id='jdbc'></a>JDBCドライバの提供</h3>

<p>JavaビルドパックはJDBCドライバを提供しません。あなたのアプリケーションがSQL RDBMSへアクセスするなら、適切なドライバをアプリケーションに含めてください。</p>

<h3><a id='memory'></a>適切なメモリの割当</h3>

<p>デプロイ時にJavaアプリケーションに適切なメモリを割当てなかった場合、起動できないかCloud Foundryによって停止させられます。Javaのヒープ、PermGen、スレッド・スタック、JVMのための余裕などとして十分なメモリを割当ててください。JavaビルドパックはPermGenのメモリ上限の10%を確保します。JVMのメモリ関連のオプションは<code>config/openjdk.yml</code>内で設定されます。(<a href="https://github.com/cloudfoundry/java-buildpack/blob/master/config/openjdk.yml)%E5%8B%95%E4%BD%9C%E4%B8%AD%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%80%81%60cf">https://github.com/cloudfoundry/java-buildpack/blob/master/config/openjdk.yml)動作中のアプリケーションについて、cf</a> statsコマンドでメモリの使用率を見ることができます。</p>

<h3><a id='upload'></a>アップロードの失敗のトラブルシュート</h3>

<p>アプリケーションをCloud Foundryへプッシュする時のアップロードに失敗した場合、以下の理由が考えられます:</p>

<ul>
<li><p>WARが大きすぎる &mdash; WARファイルの大きさのせいでアップロードが失敗することがあります。Cloud Foundryの試験では250MBのアップロードに成功しています。それより大きなWARファイルなら、大きさのせいで失敗が起こり得ます。</p></li>
<li><p>接続の問題 &mdash; インターネット接続が低速だったり、ターゲットのCloud Foundryが非常に遠いところにある場合にアップロードに失敗することがあります。アップロードに時間がかかりすぎると、アップロードが終わる前に認証トークンが期限切れになってしまうことがあり得ます。応急措置として、Cloud Foundryインスタンスに近いサーバへWARファイルをコピーし、そこからプッシュすることが挙げられます。</p></li>
<li><p>古いクライアント &mdash; より新しいcfコマンドを使った方が大きなWARファイルを高速でアップロードでき、失敗しにくくなります。大きなファイルのアップロードで問題があり、古いcfを使っているのなら、cfを最新版にしてみたください:</p>

<pre class="terminal">
$ gem update cf
</pre></li>
<li><p>まちがったWARターゲッティング &mdash; デフォルトでは、<code>cf push</code>はすべてのファイルをカレント・ディレクトリへアップロードします。Javaアプリケーションについて、<code>cf push</code>はWARだけでなくソース・コードやその他の不要なファイルもアップロードします。Javaアプリケーションをアップロードする時は、WARのパスを指定しましょう:</p>

<pre class="terminal">
cf push --path PathToWAR
</pre></li>
</ul>

<p>デプロイのマニフェスト<code>manifest.yml</code>を見て、前回のプッシュ時にパスが指定されたかどうか知ることができます。パスがカレント・ディレクトリを指定していた場合、マニフェストは以下のような行を含みます:</p>

<p><code>path: .</code> </p>

<p>WARだけをプッシュするには:</p>

<ul>
<li><p><code>manifest.yml</code>を削除し、<code>--path</code>でWARの場所を指定して再度プッシュします。あるいは</p></li>
<li><p><code>manifest.yml</code>内の<code>--path</code>でWARを指定し、再度プッシュします。</p></li>
</ul>

<h3><a id='slow-start'></a>Slow Starting Java or Grails Apps</h3>

<p>JavaやGrailsのアプリケーションでは、起動に時間がかかるのは珍しいことではありません。このことと現在のJavaビルドパックの実装から、問題が起きることがあります。JavaビルドパックはTomcatの<code>bindOnInit</code>属性を&quot;false&quot;に設定します。これによりTomcatはアプリケーションがデプロイされるまでHTTPリクエストを受信しません。アプリケーションの起動に時間がかかると、DEAのヘルス・チェックが失敗することがあります。応急措置として、Javaビルドパックを複製し、<code>bindOnInit</code> を&quot;false&quot;へ変更します。</p>

<h2><a id='node-apps'></a>Nodeのベスト・プラクティス</h2>

<ul>
<li>Node.jsアプリケーションのweb起動コマンドをプロファイルかデプロイのマニフェストで指定します。</li>
</ul>

<h2><a id='ruby-apps'></a>Rubyのベスト・プラクティス</h2>

<ul>
<li><p>プレコンパイル・アセット &mdash; ステージングの時間短縮のためにお勧めです。</p></li>
<li><p>Rails 4では<code>rails_serv_static_assets</code>を使ってください &mdash; デフォルトでは、Nginxなどの外部プロキシ経由ではないアセットに対してRails 4は404を返します。<code>rails_serve_static_assets</code> gemはRailsサーバが404を返すのではなくスタティック・アセット・ディレクトリを提供できるようにします。この機能によりエッジ・キャッシュCDNを満たしたりwebアプリケーションから直接ファイルを提供したりできます。<code>rails_serv_static_assets</code> gemは、<code>config.serve_static_assets</code>オプションを&quot;true&quot;にするとこのように振舞います。手動で設定する必要はありません。 </p></li>
</ul>

          </div><!-- End of content_inner -->
        </div><!-- End of container-full -->
      </div><!-- End of content -->
    </div><!-- End of non_footer -->
    <div id='footer'>
      <div id='container-footer'>
        <div class='bg_social'>
          <ul class='social'>
            <li>
            <a href='http://twitter.com/cloudfoundry' target='_blank'>
            <img alt='Twitter' src='/images/twitter_large.png'>
            </a>
            </li>
            <li>
            <a href='https://plus.google.com/114245065906861739918/posts' target='_blank'>
            <img alt='Google+' src='/images/g+_large.png'>
            </a>
            </li>
            <li>
            <a href='http://facebook.com/cloudfoundry' target='_blank'>
            <img alt='Facebook' src='/images/facebook_large.png'>
            </a>
            </li>
            <li>
            <a href='http://youtube.com/cloudfoundry' target='_blank'>
            <img alt='Youtube' src='/images/youtube_large.png'>
            </a>
            </li>
          </ul>
        </div><!-- End of bg_social -->
        <ul class='links'>
          <li>
          <a href='http://www.cloudfoundry.com/about'>About</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://blog.cloudfoundry.com/'>Blog</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/partners'>Partners</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://docs.cloudfoundry.com'>Docs</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/faq'>FAQ</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://status.cloudfoundry.com/'>Status</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/support'>Support</a>
          </li>
        </ul>
        <div class='copyright'>
          <div class='hr-horizontal-dark'></div>
          <br>
          <p>
            &copy;
            <script>
              //<![CDATA[
                var d = new Date();
                document.write(d.getFullYear());
              //]]>
            </script>
            GoPivotal, Inc. All rights reserved.
            <a href='http://www.cloudfoundry.com/terms'>Terms</a>
            <a href='http://www.gopivotal.com/privacy-policy' target='_blank'>Privacy</a>
          </p>
        </div><!-- End of copyright -->
      </div><!-- End of container-footer -->
    </div><!-- End of footer -->
    <script type="text/javascript">
      (function() {
        var didInit = false;
        function initMunchkin() {
          if(didInit === false) {
            didInit = true;
            Munchkin.init('625-IUJ-009');
          }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
          if (this.readyState == 'complete' || this.readyState == 'loaded') {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>
  </body>
</html>
